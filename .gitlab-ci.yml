# CI/CD configuration is temporarily disabled
# Will be re-enabled in a future sprint

stages:
  - lint
  - test
  - deploy  # ðŸ†• new stage added

# Cache node_modules to speed up builds
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - backend/node_modules/

# Lint stage: Check code quality
lint-backend:
  stage: lint
  image: node:16
  script:
    - cd backend
    - npm install
    - npm run lint
  only:
    - branches
    - merge_requests

# Test stage: Run tests
test-backend:
  stage: test
  image: node:16
  script:
    - cd backend
    - npm install
    - npx jest
  only:
    - branches
    - merge_requests

# ðŸ†• Deploy stage: Zip code and upload to S3
deploy-to-s3:
  stage: deploy
  image: amazonlinux:2
  before_script:
    - yum install -y zip unzip curl
    - curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
    - unzip awscliv2.zip
    - ./aws/install
  script:
    - zip -r app.zip .
    - aws s3 cp app.zip s3://$S3_BUCKET_NAME/app.zip --region $AWS_REGION
  only:
    - main
